{
  "prompt": "I have a batch of PDFs where some pages are rotated wrong, and I need to automatically detect and fix the orientation, then merge them all into categories based on their metadata",
  "baseline_response": "I can help you with that. Here's a Python script that can accomplish this task using several libraries:\n\n```python\nimport os\nimport PyPDF2\nimport pytesseract\nfrom PIL import Image\nfrom pdf2image import convert_from_path\nimport cv2\nimport numpy as np\nimport pandas as pd\n\ndef detect_rotation(pdf_path):\n    \"\"\"\n    Detect the correct orientation of PDF pages\n    \"\"\"\n    # Convert PDF to images\n    images = convert_from_path(pdf_path)\n    \n    # Analyze rotation for each page\n    rotations = []\n    for image in images:\n        # Convert to OpenCV format\n        cv_image = cv2.cvtColor(np.array(image), cv2.COLOR_RGB2GRAY)\n        \n        # Detect text orientation\n        text = pytesseract.image_to_osd(cv_image)\n        rotation = int(text.split('\\n')[1].split(':')[1])\n        rotations.append(rotation)\n    \n    return rotations\n\ndef rotate_pdf(input_path, output_path, rotations):\n    \"\"\"\n    Rotate PDF pages based on detected orientations\n    \"\"\"\n    reader = PyPDF2.PdfReader(input_path)\n    writer = PyPDF2.PdfWriter()\n    \n    for i, page in enumerate(reader.pages):\n        # Rotate page based on detected rotation\n        page.rotate(rotations[i])\n        writer.add_page(page)\n    \n    # Write corrected PDF\n    with open(output_path, 'wb') as out_file:\n        writer.write(out_file)\n\ndef categorize_pdfs(pdf_folder, metadata_file):\n    \"\"\"\n    Categorize PDFs based on metadata\n    \"\"\"\n    # Read metadata\n    metadata_df = pd.read_csv(metadata_file)\n    \n    # Create category folders\n    categories = metadata_df['category'].unique()\n    for category in categories:\n        os.makedirs(os.path.join(pdf_folder, category), exist_ok=True)\n    \n    # Process each PDF\n    for pdf_file in os.listdir(pdf_folder):\n        if pdf_file.endswith('.pdf'):\n            # Get PDF metadata\n            pdf_path = os.path.join(pdf_folder, pdf_file)\n            pdf_info = metadata_df[metadata_df['filename'] == pdf_file]\n            \n            if not pdf_info.empty:\n                category = pdf_info['category'].iloc[0]\n                \n                # Move PDF to category folder\n                dest_path = os.path.join(pdf_folder, category, pdf_file)\n                os.rename(pdf_path, dest_path)\n\ndef main():\n    # Process rotation for PDFs\n    pdf_folder = 'path/to/pdf/folder'\n    \n    for pdf_file in os.listdir(pdf_folder):\n        if pdf_file.endswith('.pdf'):\n            pdf_path = os.path.join(pdf_folder, pdf_file)\n            \n            # Detect rotations\n            rotations = detect_rotation(pdf_path)\n            \n            # Rotate and save corrected PDF\n            output_path = os.path.join(pdf_folder, f'corrected_{pdf_file}')\n            rotate_pdf(pdf_path, output_path, rotations)\n    \n    # Categorize PDFs\n    metadata_file = 'path/to/metadata.csv'\n    categorize_pdfs(pdf_folder, metadata_file)\n\nif __name__ == '__main__':\n    main()\n```\n\nTo use this script, you'll need to install these libraries:\n```\npip install PyPDF2 pytesseract pdf2image opencv-python-headless pandas pillow\n```\n\nYou'll also need to:\n1. Install Tesseract OCR on your system\n2. Prepare a metadata CSV with columns: filename, category\n3. Replace paths with your actual folder/file paths\n\nThe script does three main things:\n1. Detects page orientations using OCR\n2. Rotates PDFs to correct orientation\n3. Categorizes PDFs based on metadata\n\nSome notes:\n- Rotation detection works best with text-heavy documents\n- Metadata CSV should match your PDF filenames\n- Adjust paths and customize as needed\n\nWould you like me to elaborate on any part of the script?",
  "skill_response": "Here's a comprehensive script that will help you automatically detect, rotate, and categorize PDFs based on their metadata:\n\n```python\nimport os\nimport shutil\nfrom typing import List, Dict\nimport pytesseract\nfrom pdf2image import convert_from_path\nimport cv2\nimport numpy as np\nfrom pypdf import PdfReader, PdfWriter\nimport PIL.Image\n\ndef detect_page_orientation(pdf_path: str) -> Dict[int, int]:\n    \"\"\"\n    Detect and correct page orientations in a PDF\n    Returns a dictionary of page numbers and their required rotation\n    \"\"\"\n    def get_text_orientation(image):\n        # Convert to grayscale\n        gray = cv2.cvtColor(np.array(image), cv2.COLOR_RGB2GRAY)\n        \n        # Detect text orientation using Tesseract\n        details = pytesseract.image_to_osd(gray)\n        \n        # Extract rotation\n        rotation = int(details.split('\\n')[1].split(':')[1])\n        return rotation\n\n    # Convert PDF to images\n    images = convert_from_path(pdf_path, dpi=300)\n    \n    # Track rotations needed\n    page_rotations = {}\n    \n    for i, image in enumerate(images):\n        try:\n            rotation = get_text_orientation(image)\n            \n            # Map tesseract rotation to PDF rotation\n            rotation_map = {\n                0: 0,   # No rotation needed\n                90: 270,  # Rotate left\n                180: 180, # Upside down\n                270: 90   # Rotate right\n            }\n            \n            page_rotations[i] = rotation_map.get(rotation, 0)\n        except Exception as e:\n            print(f\"Could not detect orientation for page {i}: {e}\")\n            page_rotations[i] = 0\n    \n    return page_rotations\n\ndef categorize_pdf(pdf_path: str) -> str:\n    \"\"\"\n    Categorize PDF based on metadata\n    \"\"\"\n    try:\n        reader = PdfReader(pdf_path)\n        metadata = reader.metadata\n        \n        # Define categorization logic\n        if metadata and metadata.title:\n            # Categorize by title\n            return metadata.title.lower().replace(' ', '_')\n        elif metadata and metadata.author:\n            # Categorize by author\n            return metadata.author.lower().replace(' ', '_')\n        else:\n            # Default category\n            return \"uncategorized\"\n    except Exception as e:\n        print(f\"Error categorizing {pdf_path}: {e}\")\n        return \"uncategorized\"\n\ndef process_pdf_batch(input_dir: str, output_base_dir: str):\n    \"\"\"\n    Process entire batch of PDFs\n    \"\"\"\n    # Create output directories\n    os.makedirs(output_base_dir, exist_ok=True)\n    \n    # Process each PDF\n    for filename in os.listdir(input_dir):\n        if filename.endswith('.pdf'):\n            pdf_path = os.path.join(input_dir, filename)\n            \n            try:\n                # Detect and correct orientations\n                page_rotations = detect_page_orientation(pdf_path)\n                \n                # Create corrected PDF\n                reader = PdfReader(pdf_path)\n                writer = PdfWriter()\n                \n                for i, page in enumerate(reader.pages):\n                    if i in page_rotations:\n                        page.rotate(page_rotations[i])\n                    writer.add_page(page)\n                \n                # Categorize PDF\n                category = categorize_pdf(pdf_path)\n                \n                # Create category directory\n                category_dir = os.path.join(output_base_dir, category)\n                os.makedirs(category_dir, exist_ok=True)\n                \n                # Save corrected PDF\n                output_path = os.path.join(category_dir, filename)\n                with open(output_path, 'wb') as output_file:\n                    writer.write(output_file)\n                \n                print(f\"Processed {filename} into category: {category}\")\n            \n            except Exception as e:\n                print(f\"Error processing {filename}: {e}\")\n\ndef main():\n    # Configuration\n    INPUT_DIR = '/path/to/input/pdfs'\n    OUTPUT_BASE_DIR = '/path/to/output/categorized_pdfs'\n    \n    # Ensure Tesseract is configured\n    pytesseract.pytesseract.tesseract_cmd = r'/path/to/tesseract'  # Adjust path as needed\n    \n    # Process batch\n    process_pdf_batch(INPUT_DIR, OUTPUT_BASE_DIR)\n\nif __name__ == '__main__':\n    main()\n```\n\n### Prerequisites\n\nBefore running this script, you'll need to install several dependencies:\n\n```bash\npip install PyPDF2 pytesseract pdf2image opencv-python-headless Pillow reportlab\n```\n\nYou'll also need to install:\n1. Tesseract OCR (system-level installation)\n2. Poppler (for pdf2image)\n\n#### Installation (varies by OS):\n\n##### Ubuntu/Debian:\n```bash\nsudo apt-get update\nsudo apt-get install -y tesseract-ocr poppler-utils\n```\n\n##### macOS (with Homebrew):\n```bash\nbrew install tesseract poppler\n```\n\n##### Windows:\n- Download Tesseract installer from GitHub\n- Add to PATH\n- Download Poppler for Windows\n\n### Key Features\n\n1. **Automatic Orientation Detection**\n   - Uses Tesseract OCR to detect page orientation\n   - Corrects rotations (0째, 90째, 180째, 270째)\n\n2. **PDF Categorization**\n   - Uses PDF metadata (title/author) for categorization\n   - Creates directories based on categories\n   - Fallback to \"uncategorized\" if no metadata found\n\n3. **Batch Processing**\n   - Processes entire directory of PDFs\n   - Handles errors gracefully\n   - Provides detailed logging\n\n### Customization Options\n\nYou can modify the categorization logic in `categorize_pdf()`:\n```python\ndef categorize_pdf(pdf_path: str) -> str:\n    # Add more complex categorization logic\n    reader = PdfReader(pdf_path)\n    metadata = reader.metadata\n    \n    # Example: More detailed categorization\n    if metadata:\n        if 'report' in str(metadata.title).lower():\n            return 'reports'\n        elif 'invoice' in str(metadata.title).lower():\n            return 'invoices'\n    \n    return \"uncategorized\"\n```\n\n### Troubleshooting\n\n1. Adjust Tesseract path in the script\n2. Ensure all dependencies are installed\n3. Check input PDF permissions\n4. Verify OCR accuracy might require tuning\n\n### Performance Considerations\n\n- Large batches may be memory-intensive\n- Consider adding multiprocessing for large volumes\n- Add logging for better tracking\n\n### Potential Improvements\n\n- Add more robust metadata extraction\n- Implement more advanced categorization\n- Add parallel processing\n- Implement more precise rotation detection\n\n### Limitations\n\n- Relies on metadata and OCR for categorization\n- May not work perfectly for all PDF types\n- Performance can vary based on PDF complexity\n\nWould you like me to elaborate on any part of the script or discuss specific customization needs?",
  "verdict": "skill",
  "reasoning": "Response B is significantly better across all evaluation criteria. While both responses provide working Python scripts for PDF orientation detection and categorization, Response B excels in several key areas: 1) Completeness - provides comprehensive installation instructions for different operating systems, detailed troubleshooting guidance, and performance considerations; 2) Code Quality - uses modern pypdf library instead of deprecated PyPDF2, includes proper type hints, better error handling, and more robust code structure; 3) Practicality - offers concrete customization examples, discusses limitations honestly, and provides actionable next steps; 4) Documentation - includes detailed explanations of each component, installation commands, and system-specific setup instructions. Response A provides a basic working solution but lacks the depth, modern practices, and comprehensive guidance that make Response B significantly more valuable for actual implementation.",
  "baseline_tokens": 1087,
  "skill_tokens": 4029,
  "position_a": "baseline",
  "position_b": "skill",
  "judge_model": "claude-sonnet-4-20250514",
  "judged_at": "2026-01-11T16:45:14.847492Z"
}